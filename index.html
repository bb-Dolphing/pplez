<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°„í¸ ì„¤ì • ë° ì¼ì • ì ê¸ˆ ìˆ˜ì—… ì¼ì •í‘œ</title>
    <style>
        /* CSSëŠ” ìš”ì¼ë³„ ì‹œê°„ ì…ë ¥ ë¶€ë¶„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. */
        body { font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', Arial, sans-serif; margin: 20px; background-color: #f8f8f8; }
        .schedule-container { max-width: 700px; margin: 0 auto; background-color: #fff; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); border-radius: 10px; overflow: hidden; }
        h2 { text-align: center; color: #2c3e50; padding: 20px 0; margin: 0; border-bottom: 2px solid #eee; }
        .schedule-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .schedule-table th, .schedule-table td { padding: 12px 10px; text-align: center; border-bottom: 1px solid #eee; }
        .schedule-table th { background-color: #ecf0f1; color: #34495e; font-weight: bold; position: sticky; top: 0; z-index: 10; cursor: default; }
        
        /* ìš”ì¼ ë° íšŒì°¨ ì—´ ìŠ¤íƒ€ì¼ (ìˆ˜ì • ë¶ˆê°€) */
        .schedule-table td:first-child, .schedule-table td:nth-child(3) { 
            background-color: #f0f4f7;
            font-weight: bold; 
            cursor: default; 
            color: #555;
        }

        /* ì„¤ì • íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .setting-panel {
            padding: 20px;
            background-color: #e0f7fa;
            border-bottom: 2px solid #00bcd4;
        }
        .input-group { margin-bottom: 15px; }
        .input-group label { font-weight: bold; color: #00796b; display: block; margin-bottom: 5px; }
        .input-group input[type="number"], .input-group input[type="date"] {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: calc(50% - 10px);
            box-sizing: border-box;
        }
        .day-selection-group { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        .day-selection-group label {
            background-color: #fff;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: normal;
        }
        .day-selection-group input[type="checkbox"] { display: none; }
        .day-selection-group input[type="checkbox"]:checked + label {
            background-color: #00bcd4;
            color: white;
            border-color: #0097a7;
        }

        /* ìš”ì¼ë³„ ì‹œê°„ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ - ì‹œê°„ ì…ë ¥ í•„ë“œ ë„ˆë¹„ ì¡°ì • */
        #day-time-inputs {
            padding: 10px;
            border: 1px solid #b2ebf2;
            background-color: #ffffff;
            border-radius: 4px;
        }
        #day-time-inputs .time-input-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            gap: 5px; /* ì‹œê°„ í•„ë“œ ì‚¬ì´ ê°„ê²© ì¶”ê°€ */
        }
        #day-time-inputs .time-input-row label {
            font-weight: normal;
            min-width: 60px;
            color: #333;
        }
        #day-time-inputs .time-input-row .time-fields {
            display: flex;
            gap: 10px;
            flex-grow: 1;
        }
        #day-time-inputs .time-input-row .time-fields input[type="time"] {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            max-width: 120px;
            flex-grow: 1;
        }
        
        /* ë²„íŠ¼ ê·¸ë£¹ ìŠ¤íƒ€ì¼ (ì´ì „ê³¼ ë™ì¼) */
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .setting-panel button {
            padding: 10px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        #generate-schedule {
            flex-grow: 1;
            background-color: #00bcd4;
            color: white;
        }
        #generate-schedule:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #lock-toggle {
            width: 120px;
            background-color: #f39c12;
            color: white;
        }
        #lock-toggle.unlocked {
             background-color: #2ecc71;
        }

        /* ê¸°íƒ€ ìŠ¤íƒ€ì¼ */
        .editable-content { cursor: pointer; }
        .schedule-table tbody tr:nth-child(even):not(.month-header) { background-color: #f9f9f9; }
        .editable-cell input { width: 90%; padding: 5px; box-sizing: border-box; border: 1px solid #3498db; border-radius: 4px; text-align: inherit; }
        .date-input-field input[type="date"] { width: 130px; min-height: 20px; }
        #guide { text-align: left; margin-bottom: 10px; font-size: 0.9em; color: #34495e; padding-left: 10px; border-left: 3px solid #f39c12; padding: 5px 0 5px 10px; margin-left: 10px; }
    </style>
</head>
<body>

<div class="schedule-container">
    <h2>ê°„í¸ ì„¤ì • ìˆ˜ì—… ì¼ì •í‘œ</h2>

    <div class="setting-panel">
        <div class="input-group">
            <label for="total-classes">ì´ íšŒì°¨ ìˆ˜ / ìˆ˜ì—… ì‹œì‘ì¼</label>
            <input type="number" id="total-classes" value="35" min="1" max="100" style="margin-right: 10px;">
            <input type="date" id="start-date">
        </div>

        <div class="input-group">
            <label>ìˆ˜ì—… ìš”ì¼ ì„ íƒ</label>
            <div class="day-selection-group" id="day-selection-group">
                <input type="checkbox" id="day-0" value="0"><label for="day-0">ì¼</label>
                <input type="checkbox" id="day-1" value="1"><label for="day-1">ì›”</label>
                <input type="checkbox" id="day-2" value="2"><label for="day-2">í™”</label>
                <input type="checkbox" id="day-3" value="3" checked><label for="day-3">ìˆ˜</label>
                <input type="checkbox" id="day-4" value="4"><label for="day-4">ëª©</label>
                <input type="checkbox" id="day-5" value="5"><label for="day-5">ê¸ˆ</label>
                <input type="checkbox" id="day-6" value="6"><label for="day-6">í† </label>
            </div>
        </div>

        <div class="input-group">
            <label>ìš”ì¼ë³„ ìˆ˜ì—… ì‹œê°„ (ì‹œì‘ ì‹œê°„ - ì¢…ë£Œ ì‹œê°„)</label>
            <div id="day-time-inputs">
                </div>
        </div>
        
        <div class="button-group">
            <button id="lock-toggle" onclick="toggleLock()">ğŸ”’ ì ê¸ˆ í•´ì œ</button>
            <button id="generate-schedule" onclick="generateSchedule()" disabled>ì¼ì • ìƒì„±/ì—…ë°ì´íŠ¸</button>
        </div>
    </div>
    
    <hr style="margin: 0; border-color: #eee;">

    <div style="padding: 10px 0;">
        <div id="guide">
            - **[ìƒì„±/ì—…ë°ì´íŠ¸] ë²„íŠ¼ì€ ì ê¸ˆ í•´ì œ í›„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.** <span style="font-weight: bold; color: #e74c3c;">(ì‹¤ìˆ˜ ë°©ì§€)</span><br>
            - **ë‚ ì§œì™€ ì‹œê°„**ë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìœ¼ë©°, **ìš”ì¼ì€ ìë™ ë°˜ì˜ë˜ì–´ ìˆ˜ì • ë¶ˆê°€**ì…ë‹ˆë‹¤.<br>
            - **DELETE í‚¤**ë¥¼ ëˆ„ë¥´ë©´ í•´ë‹¹ íšŒì°¨ê°€ **ì˜êµ¬ ì‚­ì œ**ë©ë‹ˆë‹¤.
        </div>
    </div>

    <div class="table-wrap">
        <table class="schedule-table">
            <thead>
                <tr>
                    <th>íšŒì°¨</th>
                    <th class="editable-header">ë‚ ì§œ</th>
                    <th>ìš”ì¼</th>
                    <th class="editable-header">ì‹œê°„</th>
                </tr>
            </thead>
            <tbody id="schedule-body">
                <tr class="month-header"><td colspan="4">ğŸ‘† ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ì ê¸ˆ í•´ì œ í›„ [ì¼ì • ìƒì„±/ì—…ë°ì´íŠ¸]ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</td></tr>
            </tbody>
        </table>
    </div>
</div>

### 2. JavaScript (ì‹œê°„ ë°ì´í„° ì²˜ë¦¬ ë¡œì§ ë³€ê²½)

```javascript
<script>
    const tableBody = document.getElementById('schedule-body');
    let currentEditingCell = null;
    const currentYear = new Date().getFullYear();
    const dayNamesKo = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];

    document.addEventListener('DOMContentLoaded', () => {
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        document.getElementById('start-date').value = `${yyyy}-${mm}-${dd}`;
        
        document.getElementById('day-selection-group').addEventListener('change', updateTimeInputs);
        
        updateTimeInputs();
        
        updateLockState(true);
    });

    // ----------------------------------------------------
    // [UI/ë³´í˜¸ ë¡œì§] ì ê¸ˆ ìƒíƒœ í† ê¸€ (ì´ì „ê³¼ ë™ì¼)
    // ----------------------------------------------------
    let isLocked = true;

    const updateLockState = (locked) => {
        isLocked = locked;
        const generateButton = document.getElementById('generate-schedule');
        const lockButton = document.getElementById('lock-toggle');

        if (isLocked) {
            generateButton.disabled = true;
            lockButton.textContent = 'ğŸ”’ ì ê¸ˆ í•´ì œ';
            lockButton.classList.remove('unlocked');
        } else {
            generateButton.disabled = false;
            lockButton.textContent = 'ğŸ”“ ì ê¸ˆ ì„¤ì •';
            lockButton.classList.add('unlocked');
        }
    };

    window.toggleLock = () => {
        if (isLocked) {
            const confirmUnlock = confirm("ğŸš¨ í˜„ì¬ í…Œì´ë¸”ì˜ ë‚´ìš©ì´ ë®ì–´ì”Œì›Œì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì •ë§ë¡œ ì ê¸ˆì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì·¨ì†Œ ì‹œ ì ê¸ˆ ìœ ì§€)");
            if (confirmUnlock) {
                updateLockState(false);
            }
        } else {
            updateLockState(true);
        }
    };

    // ----------------------------------------------------
    // [UI ë¡œì§] ìš”ì¼ ì²´í¬ë°•ìŠ¤ ìƒíƒœì— ë”°ë¼ ì‹œê°„ ì…ë ¥ í•„ë“œë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±/ì œê±° (ì´ì „ê³¼ ë™ì¼)
    // ----------------------------------------------------
    const updateTimeInputs = () => {
        const timeInputContainer = document.getElementById('day-time-inputs');
        const checkboxes = document.querySelectorAll('#day-selection-group input[type="checkbox"]');
        
        const currentTimeMap = {};
        timeInputContainer.querySelectorAll('input[type="time"]').forEach(input => {
            const dayIndex = parseInt(input.dataset.day);
            const timeType = input.dataset.type;
            if (!currentTimeMap[dayIndex]) currentTimeMap[dayIndex] = {};
            currentTimeMap[dayIndex][timeType] = input.value;
        });

        timeInputContainer.innerHTML = ''; 

        checkboxes.forEach(checkbox => {
            const dayIndex = parseInt(checkbox.value);
            const dayName = dayNamesKo[dayIndex];
            
            if (checkbox.checked) {
                const existingStart = currentTimeMap[dayIndex]?.start || '10:00';
                const existingEnd = currentTimeMap[dayIndex]?.end || '13:00';
                
                const row = document.createElement('div');
                row.classList.add('time-input-row');
                row.innerHTML = `
                    <label>(${dayName})ìš”ì¼:</label>
                    <div class="time-fields">
                        <input type="time" data-day="${dayIndex}" data-type="start" value="${existingStart}" required>
                        <span>-</span>
                        <input type="time" data-day="${dayIndex}" data-type="end" value="${existingEnd}" required>
                    </div>
                `;
                timeInputContainer.appendChild(row);
            }
        });

        if (timeInputContainer.children.length === 0) {
            timeInputContainer.innerHTML = '<p style="margin: 0; color: #777;">ìˆ˜ì—… ìš”ì¼ì„ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.</p>';
        }
    };


    // ----------------------------------------------------
    // [A] í•µì‹¬ ê¸°ëŠ¥: ì¼ì • ìƒì„± ë¡œì§ (ë‚ ì§œ í˜•ì‹ YYYY.MM.DDë¡œ ë³€ê²½)
    // ----------------------------------------------------
    window.generateSchedule = () => {
        if (isLocked) return; 
        
        const totalClasses = parseInt(document.getElementById('total-classes').value);
        const startDateStr = document.getElementById('start-date').value;
        
        const selectedCheckboxes = document.querySelectorAll('#day-selection-group input[type="checkbox"]:checked');
        const targetDays = Array.from(selectedCheckboxes)
            .map(cb => parseInt(cb.value))
            .sort((a, b) => a - b);

        const timeMap = {};
        let missingTime = false;
        
        document.querySelectorAll('#day-time-inputs input[type="time"]').forEach(input => {
            const dayIndex = parseInt(input.dataset.day);
            const timeType = input.dataset.type;
            const timeValue = input.value.trim();

            if (!timeMap[dayIndex]) timeMap[dayIndex] = {};
            timeMap[dayIndex][timeType] = timeValue;

            if (!timeValue) missingTime = true;
        });
        
        const finalTimeMap = {};
        for (const dayIndex in timeMap) {
            finalTimeMap[dayIndex] = `${timeMap[dayIndex].start} - ${timeMap[dayIndex].end}`;
        }


        // --- ìœ íš¨ì„± ê²€ì‚¬ ---
        if (!startDateStr || isNaN(totalClasses) || totalClasses <= 0) {
            alert("ì´ íšŒì°¨ ìˆ˜ì™€ ìˆ˜ì—… ì‹œì‘ì¼ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }
        if (targetDays.length === 0) {
             alert("ìˆ˜ì—… ìš”ì¼ì„ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.");
            return;
        }
        if (missingTime) {
            alert("ì„ íƒëœ ëª¨ë“  ìš”ì¼ì˜ ì‹œì‘ ì‹œê°„ê³¼ ì¢…ë£Œ ì‹œê°„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.");
            return;
        }
        // ------------------

        const initialDate = new Date(startDateStr);
        let currentDate = new Date(initialDate);
        let classCount = 0;
        const newRows = [];
        let dayIndex = 0;

        while (classCount < totalClasses) {
            
            const day = currentDate.getDay();
            
            if (currentDate >= initialDate && targetDays.includes(day)) {
                
                const nextTargetDayInSequence = targetDays[dayIndex];
                
                if (day === nextTargetDayInSequence) {
                    
                    const classTime = finalTimeMap[day];
                    
                    // ğŸ“Œ ë³€ê²½: ë‚ ì§œ í˜•ì‹ì„ YYYY.MM.DDë¡œ ì„¤ì •
                    const year = currentDate.getFullYear();
                    const month = String(currentDate.getMonth() + 1).padStart(2, '0');
                    const date = String(currentDate.getDate()).padStart(2, '0');
                    const dateDisplay = `${year}.${month}.${date}`; 
                    
                    const dayOfWeek = getDayOfWeek(currentDate.toISOString().substring(0, 10));
                    
                    classCount++;
                    
                    const newRow = document.createElement('tr');
                    newRow.setAttribute('data-date', dateDisplay); // data-date ì†ì„±ë„ YYYY.MM.DD
                    newRow.innerHTML = `
                        <td>${String(classCount).padStart(2, '0')}</td>
                        <td class="editable-content date-cell" data-col="date">${dateDisplay}</td>
                        <td data-col="day">${dayOfWeek}</td> 
                        <td class="editable-content" data-col="time">${classTime}</td>
                    `;
                    newRows.push(newRow);

                    dayIndex = (dayIndex + 1) % targetDays.length;
                }
            }
            
            currentDate.setDate(currentDate.getDate() + 1);
        }

        tableBody.innerHTML = '';
        newRows.forEach(row => tableBody.appendChild(row));
        
        updateLockState(true);
        sortTable(); 
    };
    
    // ----------------------------------------------------
    // [B] í…Œì´ë¸” í¸ì§‘/ì •ë ¬/ê°±ì‹  ë¡œì§ (ë‚ ì§œ ê´€ë ¨ í•¨ìˆ˜ ì—…ë°ì´íŠ¸)
    // ----------------------------------------------------
    
    // ğŸ“Œ ë³€ê²½: data-date ì†ì„± íŒŒì‹± ë°©ì‹ ë³€ê²½ (YYYY.MM.DD)
    const parseDate = (dateStr) => {
        const parts = dateStr.split('.');
        if (parts.length === 3) { return new Date(`${parts[0]}-${parts[1]}-${parts[2]}`); }
        // Fallback for old format if necessary, though it shouldn't be needed after full update
        if (parts.length === 2) { return new Date(`${currentYear}-${parts[0]}-${parts[1]}`); }
        return null;
    };

    // ğŸ“Œ ë³€ê²½: ë‚ ì§œ ì…ë ¥ í•„ë“œ ê°’ (YYYY-MM-DD)
    const formatDateForInput = (dateStr) => {
        const parts = dateStr.split('.'); // YYYY.MM.DD
        if (parts.length === 3) { return `${parts[0]}-${parts[1]}-${parts[2]}`; }
        return '';
    };

    // ğŸ“Œ ë³€ê²½: ë‚ ì§œ í‘œì‹œ í˜•ì‹ (YYYY.MM.DD)
    const formatDateForDisplay = (dateInput) => {
        const parts = dateInput.split('-'); // YYYY-MM-DD
        if (parts.length === 3) { return `${parts[0]}.${parts[1]}.${parts[2]}`; }
        return dateInput;
    };

    const getDayOfWeek = (dateInput) => {
        let dateObj;
        if (typeof dateInput === 'string') {
            dateObj = new Date(dateInput);
        } else {
            dateObj = dateObj;
        }

        const days = ['(ì¼)', '(ì›”)', '(í™”)', '(ìˆ˜)', '(ëª©)', '(ê¸ˆ)', '(í† )'];
        if (isNaN(dateObj)) return ''; 
        return days[dateObj.getDay()];
    };

    // ğŸ“Œ ë³€ê²½: ì›”ë³„ í—¤ë” í‘œì‹œ í˜•ì‹ (YYYYë…„ MMì›”)
    const sortTable = () => {
        const rows = Array.from(tableBody.querySelectorAll('tr:not(.month-header)'));
        
        rows.sort((a, b) => {
            const dateA = parseDate(a.getAttribute('data-date'));
            const dateB = parseDate(b.getAttribute('data-date'));
            return dateA - dateB;
        });

        tableBody.innerHTML = ''; 
        
        let currentYearMonth = null;
        let currentClassNo = 0; 
        
        rows.forEach(row => {
            const dateStr = row.getAttribute('data-date'); // YYYY.MM.DD
            const dateObj = parseDate(dateStr);
            
            if (!dateObj) return;

            const year = dateObj.getFullYear();
            const month = dateObj.getMonth() + 1;
            const yearMonth = `${year}-${month}`; // ê·¸ë£¹í•‘ ê¸°ì¤€

            if (currentYearMonth !== yearMonth) {
                currentYearMonth = yearMonth;
                
                const header = document.createElement('tr');
                header.classList.add('month-header');
                header.innerHTML = `<td colspan="4">ğŸ—“ï¸ ${year}ë…„ ${month}ì›”</td>`; // ğŸ“Œ ë³€ê²½
                tableBody.appendChild(header);
            }

            currentClassNo++;
            row.querySelector('td:first-child').textContent = String(currentClassNo).padStart(2, '0');

            tableBody.appendChild(row);
        });
    };

    const saveContent = (inputElement) => {
        const parentCell = inputElement.closest('td');
        const row = parentCell.closest('tr');
        let newContent = inputElement.value.trim();

        if (parentCell.classList.contains('date-cell')) {
            // newContentëŠ” YYYY-MM-DD í˜•ì‹ (type="date" inputì˜ ì¶œë ¥ê°’)
            const dateDisplay = formatDateForDisplay(newContent); // YYYY.MM.DD í˜•ì‹ìœ¼ë¡œ ë³€ê²½
            const dayOfWeek = getDayOfWeek(newContent); // YYYY-MM-DDë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìš”ì¼ ê³„ì‚°
            
            parentCell.innerHTML = dateDisplay;
            row.setAttribute('data-date', dateDisplay); 
            
            const dayCell = row.cells[2];
            dayCell.innerHTML = dayOfWeek;

            sortTable();
        } else {
            parentCell.innerHTML = newContent;
        }

        parentCell.classList.remove('editable-cell', 'date-input-field');
        currentEditingCell = null;
    };

    tableBody.addEventListener('click', (event) => {
        const cell = event.target.closest('.editable-content');
        
        if (!cell || cell.querySelector('input')) return;
        
        if (currentEditingCell) saveContent(currentEditingCell.querySelector('input'));

        const originalContent = cell.innerHTML.trim();
        cell.classList.add('editable-cell'); 
        
        let inputHTML;
        if (cell.classList.contains('date-cell')) {
            // ë‚ ì§œ ì…ë ¥ í•„ë“œì˜ valueëŠ” YYYY-MM-DD í˜•ì‹ì´ì–´ì•¼ í•¨.
            const dateValue = formatDateForInput(originalContent); // YYYY.MM.DD -> YYYY-MM-DD
            inputHTML = `<input type="date" value="${dateValue}" />`;
            cell.classList.add('date-input-field'); 
        } else {
            inputHTML = `<input type="text" value="${originalContent.replace(/"/g, '&quot;')}" />`;
        }

        cell.innerHTML = inputHTML;
        const input = cell.querySelector('input');
        input.focus();
        currentEditingCell = cell;

        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault(); 
                saveContent(input);
                input.blur();
            }
        });
        input.addEventListener('blur', () => saveContent(input));
    });

    document.addEventListener('keydown', (event) => {
        if (currentEditingCell && event.key === 'Delete') {
            const rowToDelete = currentEditingCell.closest('tr');
            const íšŒì°¨ë²ˆí˜¸ = rowToDelete.querySelector('td').textContent;
            
            if (confirm(`ì •ë§ë¡œ íšŒì°¨ ${íšŒì°¨ë²ˆí˜¸}ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                rowToDelete.remove();
                currentEditingCell = null; 
                sortTable(); 
                event.preventDefault(); 
            }
        }
    });
</script>
</body>
</html>