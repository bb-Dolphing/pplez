<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>간편 설정 및 일정 잠금 수업 일정표</title>
    <style>
        /* CSS는 요일별 시간 입력 부분이 변경되었습니다. */
        body { font-family: 'Malgun Gothic', '맑은 고딕', Arial, sans-serif; margin: 20px; background-color: #f8f8f8; }
        .schedule-container { max-width: 700px; margin: 0 auto; background-color: #fff; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); border-radius: 10px; overflow: hidden; }
        h2 { text-align: center; color: #2c3e50; padding: 20px 0; margin: 0; border-bottom: 2px solid #eee; }
        .schedule-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .schedule-table th, .schedule-table td { padding: 12px 10px; text-align: center; border-bottom: 1px solid #eee; }
        .schedule-table th { background-color: #ecf0f1; color: #34495e; font-weight: bold; position: sticky; top: 0; z-index: 10; cursor: default; }
        
        /* 요일 및 회차 열 스타일 (수정 불가) */
        .schedule-table td:first-child, .schedule-table td:nth-child(3) { 
            background-color: #f0f4f7;
            font-weight: bold; 
            cursor: default; 
            color: #555;
        }

        /* 설정 패널 스타일 */
        .setting-panel {
            padding: 20px;
            background-color: #e0f7fa;
            border-bottom: 2px solid #00bcd4;
        }
        .input-group { margin-bottom: 15px; }
        .input-group label { font-weight: bold; color: #00796b; display: block; margin-bottom: 5px; }
        .input-group input[type="number"], .input-group input[type="date"] {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: calc(50% - 10px);
            box-sizing: border-box;
        }
        .day-selection-group { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        .day-selection-group label {
            background-color: #fff;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: normal;
        }
        .day-selection-group input[type="checkbox"] { display: none; }
        .day-selection-group input[type="checkbox"]:checked + label {
            background-color: #00bcd4;
            color: white;
            border-color: #0097a7;
        }

        /* 요일별 시간 컨테이너 스타일 - 시간 입력 필드 너비 조정 */
        #day-time-inputs {
            padding: 10px;
            border: 1px solid #b2ebf2;
            background-color: #ffffff;
            border-radius: 4px;
        }
        #day-time-inputs .time-input-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            gap: 5px; /* 시간 필드 사이 간격 추가 */
        }
        #day-time-inputs .time-input-row label {
            font-weight: normal;
            min-width: 60px;
            color: #333;
        }
        #day-time-inputs .time-input-row .time-fields {
            display: flex;
            gap: 10px;
            flex-grow: 1;
        }
        #day-time-inputs .time-input-row .time-fields input[type="time"] {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            max-width: 120px;
            flex-grow: 1;
        }
        
        /* 버튼 그룹 스타일 (이전과 동일) */
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .setting-panel button {
            padding: 10px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        #generate-schedule {
            flex-grow: 1;
            background-color: #00bcd4;
            color: white;
        }
        #generate-schedule:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #lock-toggle {
            width: 120px;
            background-color: #f39c12;
            color: white;
        }
        #lock-toggle.unlocked {
             background-color: #2ecc71;
        }

        /* 기타 스타일 */
        .editable-content { cursor: pointer; }
        .schedule-table tbody tr:nth-child(even):not(.month-header) { background-color: #f9f9f9; }
        .editable-cell input { width: 90%; padding: 5px; box-sizing: border-box; border: 1px solid #3498db; border-radius: 4px; text-align: inherit; }
        .date-input-field input[type="date"] { width: 130px; min-height: 20px; }
        #guide { text-align: left; margin-bottom: 10px; font-size: 0.9em; color: #34495e; padding-left: 10px; border-left: 3px solid #f39c12; padding: 5px 0 5px 10px; margin-left: 10px; }
    </style>
</head>
<body>

<div class="schedule-container">
    <h2>간편 설정 수업 일정표</h2>

    <div class="setting-panel">
        <div class="input-group">
            <label for="total-classes">총 회차 수 / 수업 시작일</label>
            <input type="number" id="total-classes" value="35" min="1" max="100" style="margin-right: 10px;">
            <input type="date" id="start-date">
        </div>

        <div class="input-group">
            <label>수업 요일 선택</label>
            <div class="day-selection-group" id="day-selection-group">
                <input type="checkbox" id="day-0" value="0"><label for="day-0">일</label>
                <input type="checkbox" id="day-1" value="1"><label for="day-1">월</label>
                <input type="checkbox" id="day-2" value="2"><label for="day-2">화</label>
                <input type="checkbox" id="day-3" value="3" checked><label for="day-3">수</label>
                <input type="checkbox" id="day-4" value="4"><label for="day-4">목</label>
                <input type="checkbox" id="day-5" value="5"><label for="day-5">금</label>
                <input type="checkbox" id="day-6" value="6"><label for="day-6">토</label>
            </div>
        </div>

        <div class="input-group">
            <label>요일별 수업 시간 (시작 시간 - 종료 시간)</label>
            <div id="day-time-inputs">
                </div>
        </div>
        
        <div class="button-group">
            <button id="lock-toggle" onclick="toggleLock()">🔒 잠금 해제</button>
            <button id="generate-schedule" onclick="generateSchedule()" disabled>일정 생성/업데이트</button>
        </div>
    </div>
    
    <hr style="margin: 0; border-color: #eee;">

    <div style="padding: 10px 0;">
        <div id="guide">
            - **[생성/업데이트] 버튼은 잠금 해제 후 사용 가능합니다.** <span style="font-weight: bold; color: #e74c3c;">(실수 방지)</span><br>
            - **날짜와 시간**만 수정할 수 있으며, **요일은 자동 반영되어 수정 불가**입니다.<br>
            - **DELETE 키**를 누르면 해당 회차가 **영구 삭제**됩니다.
        </div>
    </div>

    <div class="table-wrap">
        <table class="schedule-table">
            <thead>
                <tr>
                    <th>회차</th>
                    <th class="editable-header">날짜</th>
                    <th>요일</th>
                    <th class="editable-header">시간</th>
                </tr>
            </thead>
            <tbody id="schedule-body">
                <tr class="month-header"><td colspan="4">👆 정보를 입력하고 잠금 해제 후 [일정 생성/업데이트]를 눌러주세요.</td></tr>
            </tbody>
        </table>
    </div>
</div>

### 2. JavaScript (시간 데이터 처리 로직 변경)

```javascript
<script>
    const tableBody = document.getElementById('schedule-body');
    let currentEditingCell = null;
    const currentYear = new Date().getFullYear();
    const dayNamesKo = ['일', '월', '화', '수', '목', '금', '토'];

    document.addEventListener('DOMContentLoaded', () => {
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        document.getElementById('start-date').value = `${yyyy}-${mm}-${dd}`;
        
        document.getElementById('day-selection-group').addEventListener('change', updateTimeInputs);
        
        updateTimeInputs();
        
        updateLockState(true);
    });

    // ----------------------------------------------------
    // [UI/보호 로직] 잠금 상태 토글 (이전과 동일)
    // ----------------------------------------------------
    let isLocked = true;

    const updateLockState = (locked) => {
        isLocked = locked;
        const generateButton = document.getElementById('generate-schedule');
        const lockButton = document.getElementById('lock-toggle');

        if (isLocked) {
            generateButton.disabled = true;
            lockButton.textContent = '🔒 잠금 해제';
            lockButton.classList.remove('unlocked');
        } else {
            generateButton.disabled = false;
            lockButton.textContent = '🔓 잠금 설정';
            lockButton.classList.add('unlocked');
        }
    };

    window.toggleLock = () => {
        if (isLocked) {
            const confirmUnlock = confirm("🚨 현재 테이블의 내용이 덮어씌워질 수 있습니다. 정말로 잠금을 해제하시겠습니까? (취소 시 잠금 유지)");
            if (confirmUnlock) {
                updateLockState(false);
            }
        } else {
            updateLockState(true);
        }
    };

    // ----------------------------------------------------
    // [UI 로직] 요일 체크박스 상태에 따라 시간 입력 필드를 동적으로 생성/제거 (이전과 동일)
    // ----------------------------------------------------
    const updateTimeInputs = () => {
        const timeInputContainer = document.getElementById('day-time-inputs');
        const checkboxes = document.querySelectorAll('#day-selection-group input[type="checkbox"]');
        
        const currentTimeMap = {};
        timeInputContainer.querySelectorAll('input[type="time"]').forEach(input => {
            const dayIndex = parseInt(input.dataset.day);
            const timeType = input.dataset.type;
            if (!currentTimeMap[dayIndex]) currentTimeMap[dayIndex] = {};
            currentTimeMap[dayIndex][timeType] = input.value;
        });

        timeInputContainer.innerHTML = ''; 

        checkboxes.forEach(checkbox => {
            const dayIndex = parseInt(checkbox.value);
            const dayName = dayNamesKo[dayIndex];
            
            if (checkbox.checked) {
                const existingStart = currentTimeMap[dayIndex]?.start || '10:00';
                const existingEnd = currentTimeMap[dayIndex]?.end || '13:00';
                
                const row = document.createElement('div');
                row.classList.add('time-input-row');
                row.innerHTML = `
                    <label>(${dayName})요일:</label>
                    <div class="time-fields">
                        <input type="time" data-day="${dayIndex}" data-type="start" value="${existingStart}" required>
                        <span>-</span>
                        <input type="time" data-day="${dayIndex}" data-type="end" value="${existingEnd}" required>
                    </div>
                `;
                timeInputContainer.appendChild(row);
            }
        });

        if (timeInputContainer.children.length === 0) {
            timeInputContainer.innerHTML = '<p style="margin: 0; color: #777;">수업 요일을 1개 이상 선택해주세요.</p>';
        }
    };


    // ----------------------------------------------------
    // [A] 핵심 기능: 일정 생성 로직 (날짜 형식 YYYY.MM.DD로 변경)
    // ----------------------------------------------------
    window.generateSchedule = () => {
        if (isLocked) return; 
        
        const totalClasses = parseInt(document.getElementById('total-classes').value);
        const startDateStr = document.getElementById('start-date').value;
        
        const selectedCheckboxes = document.querySelectorAll('#day-selection-group input[type="checkbox"]:checked');
        const targetDays = Array.from(selectedCheckboxes)
            .map(cb => parseInt(cb.value))
            .sort((a, b) => a - b);

        const timeMap = {};
        let missingTime = false;
        
        document.querySelectorAll('#day-time-inputs input[type="time"]').forEach(input => {
            const dayIndex = parseInt(input.dataset.day);
            const timeType = input.dataset.type;
            const timeValue = input.value.trim();

            if (!timeMap[dayIndex]) timeMap[dayIndex] = {};
            timeMap[dayIndex][timeType] = timeValue;

            if (!timeValue) missingTime = true;
        });
        
        const finalTimeMap = {};
        for (const dayIndex in timeMap) {
            finalTimeMap[dayIndex] = `${timeMap[dayIndex].start} - ${timeMap[dayIndex].end}`;
        }


        // --- 유효성 검사 ---
        if (!startDateStr || isNaN(totalClasses) || totalClasses <= 0) {
            alert("총 회차 수와 수업 시작일을 정확히 입력해주세요.");
            return;
        }
        if (targetDays.length === 0) {
             alert("수업 요일을 1개 이상 선택해주세요.");
            return;
        }
        if (missingTime) {
            alert("선택된 모든 요일의 시작 시간과 종료 시간을 설정해주세요.");
            return;
        }
        // ------------------

        const initialDate = new Date(startDateStr);
        let currentDate = new Date(initialDate);
        let classCount = 0;
        const newRows = [];
        let dayIndex = 0;

        while (classCount < totalClasses) {
            
            const day = currentDate.getDay();
            
            if (currentDate >= initialDate && targetDays.includes(day)) {
                
                const nextTargetDayInSequence = targetDays[dayIndex];
                
                if (day === nextTargetDayInSequence) {
                    
                    const classTime = finalTimeMap[day];
                    
                    // 📌 변경: 날짜 형식을 YYYY.MM.DD로 설정
                    const year = currentDate.getFullYear();
                    const month = String(currentDate.getMonth() + 1).padStart(2, '0');
                    const date = String(currentDate.getDate()).padStart(2, '0');
                    const dateDisplay = `${year}.${month}.${date}`; 
                    
                    const dayOfWeek = getDayOfWeek(currentDate.toISOString().substring(0, 10));
                    
                    classCount++;
                    
                    const newRow = document.createElement('tr');
                    newRow.setAttribute('data-date', dateDisplay); // data-date 속성도 YYYY.MM.DD
                    newRow.innerHTML = `
                        <td>${String(classCount).padStart(2, '0')}</td>
                        <td class="editable-content date-cell" data-col="date">${dateDisplay}</td>
                        <td data-col="day">${dayOfWeek}</td> 
                        <td class="editable-content" data-col="time">${classTime}</td>
                    `;
                    newRows.push(newRow);

                    dayIndex = (dayIndex + 1) % targetDays.length;
                }
            }
            
            currentDate.setDate(currentDate.getDate() + 1);
        }

        tableBody.innerHTML = '';
        newRows.forEach(row => tableBody.appendChild(row));
        
        updateLockState(true);
        sortTable(); 
    };
    
    // ----------------------------------------------------
    // [B] 테이블 편집/정렬/갱신 로직 (날짜 관련 함수 업데이트)
    // ----------------------------------------------------
    
    // 📌 변경: data-date 속성 파싱 방식 변경 (YYYY.MM.DD)
    const parseDate = (dateStr) => {
        const parts = dateStr.split('.');
        if (parts.length === 3) { return new Date(`${parts[0]}-${parts[1]}-${parts[2]}`); }
        // Fallback for old format if necessary, though it shouldn't be needed after full update
        if (parts.length === 2) { return new Date(`${currentYear}-${parts[0]}-${parts[1]}`); }
        return null;
    };

    // 📌 변경: 날짜 입력 필드 값 (YYYY-MM-DD)
    const formatDateForInput = (dateStr) => {
        const parts = dateStr.split('.'); // YYYY.MM.DD
        if (parts.length === 3) { return `${parts[0]}-${parts[1]}-${parts[2]}`; }
        return '';
    };

    // 📌 변경: 날짜 표시 형식 (YYYY.MM.DD)
    const formatDateForDisplay = (dateInput) => {
        const parts = dateInput.split('-'); // YYYY-MM-DD
        if (parts.length === 3) { return `${parts[0]}.${parts[1]}.${parts[2]}`; }
        return dateInput;
    };

    const getDayOfWeek = (dateInput) => {
        let dateObj;
        if (typeof dateInput === 'string') {
            dateObj = new Date(dateInput);
        } else {
            dateObj = dateObj;
        }

        const days = ['(일)', '(월)', '(화)', '(수)', '(목)', '(금)', '(토)'];
        if (isNaN(dateObj)) return ''; 
        return days[dateObj.getDay()];
    };

    // 📌 변경: 월별 헤더 표시 형식 (YYYY년 MM월)
    const sortTable = () => {
        const rows = Array.from(tableBody.querySelectorAll('tr:not(.month-header)'));
        
        rows.sort((a, b) => {
            const dateA = parseDate(a.getAttribute('data-date'));
            const dateB = parseDate(b.getAttribute('data-date'));
            return dateA - dateB;
        });

        tableBody.innerHTML = ''; 
        
        let currentYearMonth = null;
        let currentClassNo = 0; 
        
        rows.forEach(row => {
            const dateStr = row.getAttribute('data-date'); // YYYY.MM.DD
            const dateObj = parseDate(dateStr);
            
            if (!dateObj) return;

            const year = dateObj.getFullYear();
            const month = dateObj.getMonth() + 1;
            const yearMonth = `${year}-${month}`; // 그룹핑 기준

            if (currentYearMonth !== yearMonth) {
                currentYearMonth = yearMonth;
                
                const header = document.createElement('tr');
                header.classList.add('month-header');
                header.innerHTML = `<td colspan="4">🗓️ ${year}년 ${month}월</td>`; // 📌 변경
                tableBody.appendChild(header);
            }

            currentClassNo++;
            row.querySelector('td:first-child').textContent = String(currentClassNo).padStart(2, '0');

            tableBody.appendChild(row);
        });
    };

    const saveContent = (inputElement) => {
        const parentCell = inputElement.closest('td');
        const row = parentCell.closest('tr');
        let newContent = inputElement.value.trim();

        if (parentCell.classList.contains('date-cell')) {
            // newContent는 YYYY-MM-DD 형식 (type="date" input의 출력값)
            const dateDisplay = formatDateForDisplay(newContent); // YYYY.MM.DD 형식으로 변경
            const dayOfWeek = getDayOfWeek(newContent); // YYYY-MM-DD를 기준으로 요일 계산
            
            parentCell.innerHTML = dateDisplay;
            row.setAttribute('data-date', dateDisplay); 
            
            const dayCell = row.cells[2];
            dayCell.innerHTML = dayOfWeek;

            sortTable();
        } else {
            parentCell.innerHTML = newContent;
        }

        parentCell.classList.remove('editable-cell', 'date-input-field');
        currentEditingCell = null;
    };

    tableBody.addEventListener('click', (event) => {
        const cell = event.target.closest('.editable-content');
        
        if (!cell || cell.querySelector('input')) return;
        
        if (currentEditingCell) saveContent(currentEditingCell.querySelector('input'));

        const originalContent = cell.innerHTML.trim();
        cell.classList.add('editable-cell'); 
        
        let inputHTML;
        if (cell.classList.contains('date-cell')) {
            // 날짜 입력 필드의 value는 YYYY-MM-DD 형식이어야 함.
            const dateValue = formatDateForInput(originalContent); // YYYY.MM.DD -> YYYY-MM-DD
            inputHTML = `<input type="date" value="${dateValue}" />`;
            cell.classList.add('date-input-field'); 
        } else {
            inputHTML = `<input type="text" value="${originalContent.replace(/"/g, '&quot;')}" />`;
        }

        cell.innerHTML = inputHTML;
        const input = cell.querySelector('input');
        input.focus();
        currentEditingCell = cell;

        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault(); 
                saveContent(input);
                input.blur();
            }
        });
        input.addEventListener('blur', () => saveContent(input));
    });

    document.addEventListener('keydown', (event) => {
        if (currentEditingCell && event.key === 'Delete') {
            const rowToDelete = currentEditingCell.closest('tr');
            const 회차번호 = rowToDelete.querySelector('td').textContent;
            
            if (confirm(`정말로 회차 ${회차번호}을(를) 삭제하시겠습니까?`)) {
                rowToDelete.remove();
                currentEditingCell = null; 
                sortTable(); 
                event.preventDefault(); 
            }
        }
    });
</script>
</body>
</html>