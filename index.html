<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°„í¸ ì„¤ì • ë° ì ê¸ˆ ìˆ˜ì—… ì¼ì •í‘œ</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body { font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', Arial, sans-serif; margin: 20px; background-color: #f8f8f8; }
        .schedule-container { max-width: 750px; margin: 0 auto; background-color: #fff; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); border-radius: 10px; overflow: hidden; }
        h2 { text-align: center; color: #2c3e50; padding: 20px 0; margin: 0; border-bottom: 2px solid #eee; }
        .schedule-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .schedule-table th, .schedule-table td { padding: 12px 10px; text-align: center; border-bottom: 1px solid #eee; }
        .schedule-table th { background-color: #ecf0f1; color: #34495e; font-weight: bold; position: sticky; top: 0; z-index: 10; cursor: default; }
        
        /* íšŒì°¨, ìš”ì¼ ì…€ (ë°°ê²½ ìˆëŠ” ì…€) */
        .schedule-table td:first-child, .schedule-table td:nth-child(3) { 
            background-color: #f0f4f7;
            font-weight: bold; 
            cursor: default; 
            color: #555;
        }
        
        /* ì£¼ë§ ìƒ‰ìƒ ê°•ì¡° */
        .day-0 { color: #e74c3c !important; font-weight: bold; } /* ì¼ìš”ì¼: ë¹¨ê°„ìƒ‰ */
        .day-6 { color: #3498db !important; font-weight: bold; } /* í† ìš”ì¼: íŒŒë€ìƒ‰ */

        /* ë‚ ì§œ/ì‹œê°„ ì…€ì˜ ì£¼ë§ ìƒ‰ìƒ (editable-content) */
        td.editable-content.day-0 { color: #e74c3c !important; }
        td.editable-content.day-6 { color: #3498db !important; }

        .schedule-table tbody tr:nth-child(even):not(.month-header) { background-color: #f9f9f9; }
        .editable-content { cursor: pointer; }
        
        /* í…ìŠ¤íŠ¸/ë‚ ì§œ ì…ë ¥ í•„ë“œ ìŠ¤íƒ€ì¼ */
        .editable-cell input[type="text"], .editable-cell input[type="date"] { 
            width: 90%; padding: 5px; box-sizing: border-box; 
            border: 1px solid #3498db; border-radius: 4px; text-align: inherit; 
        }
        .date-input-field input[type="date"] { width: 130px; min-height: 20px; }

        /* ì‹œê°„ ìˆ˜ì • ì‹œ, ì‹œê°„ í•„ë“œ ë¶„ë¦¬ ë ˆì´ì•„ì›ƒ */
        .time-input-fields {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        .time-input-fields input[type="time"] {
            width: 70px; /* ì‹œê°„ ì…ë ¥ í•„ë“œ ë„ˆë¹„ ì¡°ì • */
            padding: 5px;
            border: 1px solid #3498db;
            border-radius: 4px;
        }
        .time-input-fields span {
            font-weight: bold;
            color: #555;
        }
        
        /* ì„¤ì • íŒ¨ë„ ìŠ¤íƒ€ì¼ */
        .setting-panel {
            padding: 20px;
            background-color: #e0f7fa;
            border-bottom: 2px solid #00bcd4;
        }
        .input-group { margin-bottom: 15px; }
        .input-group label { font-weight: bold; color: #00796b; display: block; margin-bottom: 5px; }
        .input-group input[type="number"], .input-group input[type="date"] {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: calc(50% - 10px);
            box-sizing: border-box;
        }

        /* ìš”ì¼ ì„ íƒ */
        .day-selection-group { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        .day-selection-group label {
            background-color: #fff;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: normal;
        }
        .day-selection-group input[type="checkbox"] { display: none; }
        .day-selection-group input[type="checkbox"]:checked + label {
            background-color: #00bcd4;
            color: white;
            border-color: #0097a7;
        }

        /* ìš”ì¼ë³„ ì‹œê°„ ì»¨í…Œì´ë„ˆ */
        #day-time-inputs {
            padding: 10px;
            border: 1px solid #b2ebf2;
            background-color: #ffffff;
            border-radius: 4px;
        }
        #day-time-inputs .time-input-row {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            gap: 10px;
        }
        #day-time-inputs .time-input-row label {
            font-weight: normal;
            min-width: 70px;
            color: #333;
        }
        #day-time-inputs .time-input-row .time-fields {
            display: flex;
            gap: 10px;
            flex-grow: 1;
        }
        #day-time-inputs .time-input-row .time-fields input[type="time"] {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            max-width: 120px;
            flex-grow: 1;
        }
        
        /* ë²„íŠ¼ ê·¸ë£¹ ìŠ¤íƒ€ì¼ */
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            align-items: center;
        }
        .setting-panel button {
            padding: 10px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        #generate-schedule {
            flex-grow: 1;
            background-color: #00bcd4;
            color: white;
        }
        #generate-schedule:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #lock-toggle {
            width: 120px;
            background-color: #f39c12;
            color: white;
        }
        #lock-toggle.unlocked {
             background-color: #2ecc71;
        }

        /* ì •ë³´ ì•„ì´ì½˜ ë° íˆ´íŒ ìŠ¤íƒ€ì¼ */
        .info-tooltip-container {
            position: relative; 
            display: flex;
            align-items: center;
        }

        .info-icon {
            font-size: 1.2em;
            font-weight: bold;
            color: #3498db;
            cursor: pointer;
            border: 1px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            line-height: 18px;
            text-align: center;
            display: inline-block;
            user-select: none;
            margin-right: 5px;
        }

        .info-tooltip-text {
            visibility: hidden;
            width: 280px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 9999; 
            bottom: 145%;
            left: 50%;
            margin-left: -140px; 
            opacity: 0;
            transition: opacity 0.3s, visibility 0.3s;
            font-size: 0.85em;
            line-height: 1.4;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .info-tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        .info-tooltip-text.visible {
            visibility: visible;
            opacity: 1;
        }

        #guide { text-align: left; margin-bottom: 10px; font-size: 0.9em; color: #34495e; padding-left: 10px; border-left: 3px solid #f39c12; padding: 5px 0 5px 10px; margin-left: 10px; }
    </style>
</head>
<body>

<div class="schedule-container">
    <h2>ê°„í¸ ì„¤ì • ìˆ˜ì—… ì¼ì •í‘œ</h2>

    <div class="setting-panel">
        <div class="input-group">
            <label for="total-classes">**ì´ íšŒì°¨ ìˆ˜ (ì ˆëŒ€ ê³ ì •)** / ìˆ˜ì—… ì‹œì‘ì¼</label>
            <input type="number" id="total-classes" value="35" min="1" max="100" style="margin-right: 10px;">
            <input type="date" id="start-date">
        </div>

        <div class="input-group">
            <label>ìˆ˜ì—… ìš”ì¼ ì„ íƒ</label>
            <div class="day-selection-group" id="day-selection-group">
                <input type="checkbox" id="day-0" value="0"><label for="day-0">ì¼</label>
                <input type="checkbox" id="day-1" value="1"><label for="day-1">ì›”</label>
                <input type="checkbox" id="day-2" value="2"><label for="day-2">í™”</label>
                <input type="checkbox" id="day-3" value="3" checked><label for="day-3">ìˆ˜</label>
                <input type="checkbox" id="day-4" value="4"><label for="day-4">ëª©</label>
                <input type="checkbox" id="day-5" value="5"><label for="day-5">ê¸ˆ</label>
                <input type="checkbox" id="day-6" value="6"><label for="day-6">í† </label>
            </div>
        </div>

        <div class="input-group">
            <label>ìš”ì¼ë³„ ìˆ˜ì—… ì‹œê°„ (ì‹œì‘ ì‹œê°„ - ì¢…ë£Œ ì‹œê°„, **10ë¶„ ë‹¨ìœ„**)</label>
            <div id="day-time-inputs">
                </div>
        </div>
        
        <div class="button-group">
            <div class="info-tooltip-container">
                <span id="lock-info-icon" class="info-icon" onclick="toggleTooltip(event)">â“˜</span>
                <div id="lock-info-tooltip" class="info-tooltip-text">
                    * **ì¼ì • ì ê¸ˆ/í•´ì œ ê¸°ëŠ¥ ì•ˆë‚´** *<br>
                    í…Œì´ë¸” ë‚´ìš©ì„ ì‹¤ìˆ˜ë¡œ ë®ì–´ì“°ì§€ ì•Šë„ë¡ **ì ê¸ˆ ìƒíƒœ**ê°€ ê¸°ë³¸ì…ë‹ˆë‹¤.<br><br>
                    [ğŸ”’ ì ê¸ˆ í•´ì œ]ë¥¼ ëˆ„ë¥´ë©´ ì¼ì •ì„ ìƒˆë¡œ ë§Œë“¤ê±°ë‚˜ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>
            </div>
            
            <button id="lock-toggle" onclick="toggleLock()">ğŸ”’ ì ê¸ˆ í•´ì œ</button>
            <button id="generate-schedule" onclick="generateSchedule()" disabled>ì¼ì • ìƒì„±/ì—…ë°ì´íŠ¸</button>
        </div>
    </div>
    
    <hr style="margin: 0; border-color: #eee;">

    <div style="padding: 10px 0;">
        <div id="guide">
            - **[ìƒì„±/ì—…ë°ì´íŠ¸] ë²„íŠ¼ì€ ì ê¸ˆ í•´ì œ í›„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.** <span style="font-weight: bold; color: #e74c3c;">(ì‹¤ìˆ˜ ë°©ì§€)</span><br>
            - **ë‚ ì§œë¥¼ ìˆ˜ì •**í•˜ë©´ ìš”ì¼ì€ ìë™ ë°˜ì˜ë©ë‹ˆë‹¤. <span style="color: #3498db;">(ë‚ ì§œ: YYYY.MM.DD í˜•ì‹)</span><br>
            - **í† ìš”ì¼ì€ íŒŒë€ìƒ‰, ì¼ìš”ì¼ì€ ë¹¨ê°„ìƒ‰**ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.<br>
            - **ì´ íšŒì°¨ ìˆ˜(Total Classes)ëŠ” ì ˆëŒ€ ë³€í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**
        </div>
    </div>

    <div class="table-wrap">
        <table class="schedule-table">
            <thead>
                <tr>
                    <th>íšŒì°¨</th>
                    <th class="editable-header">ë‚ ì§œ</th>
                    <th>ìš”ì¼</th>
                    <th class="editable-header">ì‹œê°„</th>
                </tr>
            </thead>
            <tbody id="schedule-body">
                <tr class="month-header"><td colspan="4">ğŸ‘† ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ì ê¸ˆ í•´ì œ í›„ [ì¼ì • ìƒì„±/ì—…ë°ì´íŠ¸]ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    const tableBody = document.getElementById('schedule-body');
    const totalClassesInput = document.getElementById('total-classes');
    let currentEditingCell = null;
    const currentYear = new Date().getFullYear();
    const dayNamesKo = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];

    document.addEventListener('DOMContentLoaded', () => {
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        document.getElementById('start-date').value = `${yyyy}-${mm}-${dd}`;
        
        document.getElementById('day-selection-group').addEventListener('change', updateTimeInputs);
        
        updateTimeInputs();
        
        updateLockState(true);
    });

    // ----------------------------------------------------
    // [UI ë¡œì§] ì •ë³´ ì•„ì´ì½˜ í´ë¦­ í† ê¸€
    // ----------------------------------------------------
    window.toggleTooltip = (event) => {
        const tooltip = document.getElementById('lock-info-tooltip');
        tooltip.classList.toggle('visible');
        event.stopPropagation();
    };

    // íˆ´íŒ ì™¸ë¶€ í´ë¦­ ì‹œ íˆ´íŒ ë‹«ê¸°
    document.addEventListener('click', (event) => {
        const tooltip = document.getElementById('lock-info-tooltip');
        const icon = document.getElementById('lock-info-icon');
        
        if (tooltip && !tooltip.contains(event.target) && !icon.contains(event.target)) {
            tooltip.classList.remove('visible');
        }
    });

    // ----------------------------------------------------
    // [UI/ë³´í˜¸ ë¡œì§] ì ê¸ˆ ìƒíƒœ í† ê¸€
    // ----------------------------------------------------
    let isLocked = true;

    const updateLockState = (locked) => {
        isLocked = locked;
        const generateButton = document.getElementById('generate-schedule');
        const lockButton = document.getElementById('lock-toggle');

        if (isLocked) {
            generateButton.disabled = true;
            lockButton.textContent = 'ğŸ”’ ì ê¸ˆ í•´ì œ';
            lockButton.classList.remove('unlocked');
        } else {
            generateButton.disabled = false;
            lockButton.textContent = 'ğŸ”“ ì ê¸ˆ ì„¤ì •';
            lockButton.classList.add('unlocked');
        }
    };

    window.toggleLock = () => {
        if (isLocked) {
            const confirmUnlock = confirm("ğŸš¨ í˜„ì¬ í…Œì´ë¸”ì˜ ë‚´ìš©ì´ ë®ì–´ì”Œì›Œì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì •ë§ë¡œ ì ê¸ˆì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì·¨ì†Œ ì‹œ ì ê¸ˆ ìœ ì§€)");
            if (confirmUnlock) {
                updateLockState(false);
            }
        } else {
            updateLockState(true);
        }
    };

    // ----------------------------------------------------
    // [UI ë¡œì§] ìš”ì¼ ì²´í¬ë°•ìŠ¤ ìƒíƒœì— ë”°ë¼ ì‹œê°„ ì…ë ¥ í•„ë“œë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±/ì œê±°
    // ----------------------------------------------------
    const updateTimeInputs = () => {
        const timeInputContainer = document.getElementById('day-time-inputs');
        const checkboxes = document.querySelectorAll('#day-selection-group input[type="checkbox"]');
        
        const currentTimeMap = {};
        timeInputContainer.querySelectorAll('input[type="time"]').forEach(input => {
            const dayIndex = parseInt(input.dataset.day);
            const timeType = input.dataset.type;
            if (!currentTimeMap[dayIndex]) currentTimeMap[dayIndex] = {};
            currentTimeMap[dayIndex][timeType] = input.value;
        });

        timeInputContainer.innerHTML = ''; 

        checkboxes.forEach(checkbox => {
            const dayIndex = parseInt(checkbox.value);
            const dayName = dayNamesKo[dayIndex];
            
            if (checkbox.checked) {
                const existingStart = currentTimeMap[dayIndex]?.start || '10:00';
                const existingEnd = currentTimeMap[dayIndex]?.end || '13:00';
                
                const row = document.createElement('div');
                row.classList.add('time-input-row');
                row.innerHTML = `
                    <label>(${dayName})ìš”ì¼:</label>
                    <div class="time-fields">
                        <input type="time" data-day="${dayIndex}" data-type="start" value="${existingStart}" required step="600">
                        <span>-</span>
                        <input type="time" data-day="${dayIndex}" data-type="end" value="${existingEnd}" required step="600">
                    </div>
                `;
                timeInputContainer.appendChild(row);
            }
        });

        if (timeInputContainer.children.length === 0) {
            timeInputContainer.innerHTML = '<p style="margin: 0; color: #777;">ìˆ˜ì—… ìš”ì¼ì„ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.</p>';
        }
    };


    // ----------------------------------------------------
    // [A] í•µì‹¬ ê¸°ëŠ¥: ì¼ì • ìƒì„± ë¡œì§ (ì´ íšŒì°¨ ìˆ˜ ê³ ì •)
    // ----------------------------------------------------
    window.generateSchedule = () => {
        if (isLocked) return; 
        
        const totalClasses = parseInt(totalClassesInput.value);
        const startDateStr = document.getElementById('start-date').value;
        
        const selectedCheckboxes = document.querySelectorAll('#day-selection-group input[type="checkbox"]:checked');
        const targetDays = Array.from(selectedCheckboxes)
            .map(cb => parseInt(cb.value))
            .sort((a, b) => a - b);

        const timeMap = {};
        let missingTime = false;
        
        document.querySelectorAll('#day-time-inputs input[type="time"]').forEach(input => {
            const dayIndex = parseInt(input.dataset.day);
            const timeType = input.dataset.type;
            const timeValue = input.value.trim();

            if (!timeMap[dayIndex]) timeMap[dayIndex] = {};

            timeMap[dayIndex][timeType] = timeValue;

            if (!timeValue) missingTime = true;
        });
        
        const finalTimeMap = {};
        for (const dayIndex in timeMap) {
            finalTimeMap[dayIndex] = {
                display: `${timeMap[dayIndex].start} - ${timeMap[dayIndex].end}`,
                start: timeMap[dayIndex].start,
                end: timeMap[dayIndex].end
            };
        }


        // --- ìœ íš¨ì„± ê²€ì‚¬ ---
        if (!startDateStr || isNaN(totalClasses) || totalClasses <= 0) {
            alert("ì´ íšŒì°¨ ìˆ˜ì™€ ìˆ˜ì—… ì‹œì‘ì¼ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }
        if (targetDays.length === 0) {
             alert("ìˆ˜ì—… ìš”ì¼ì„ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.");
            return;
        }
        if (missingTime) {
            alert("ì„ íƒëœ ëª¨ë“  ìš”ì¼ì˜ ì‹œì‘ ì‹œê°„ê³¼ ì¢…ë£Œ ì‹œê°„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.");
            return;
        }
        // ------------------

        const initialDate = new Date(startDateStr);
        let currentDate = new Date(initialDate);
        let classCount = 0;
        const newRows = [];
        let dayIndex = 0;

        while (classCount < totalClasses) {
            
            const day = currentDate.getDay(); // 0(ì¼) ~ 6(í† )
            
            if (currentDate >= initialDate && targetDays.includes(day)) {
                
                const nextTargetDayInSequence = targetDays[dayIndex];
                
                if (day === nextTargetDayInSequence) {
                    
                    const timeData = finalTimeMap[day];
                    
                    const year = currentDate.getFullYear();
                    const month = String(currentDate.getMonth() + 1).padStart(2, '0');
                    const date = String(currentDate.getDate()).padStart(2, '0');
                    const dateDisplay = `${year}.${month}.${date}`; 
                    
                    const dayOfWeek = getDayOfWeek(currentDate.toISOString().substring(0, 10));
                    
                    classCount++;
                    
                    const newRow = document.createElement('tr');
                    newRow.setAttribute('data-date', dateDisplay); 
                    newRow.setAttribute('data-class-no', classCount); // íšŒì°¨ ë²ˆí˜¸ ê³ ì •
                    newRow.setAttribute('data-start-time', timeData.start); // ì‹œì‘ ì‹œê°„ ì €ì¥
                    newRow.setAttribute('data-end-time', timeData.end); // ì¢…ë£Œ ì‹œê°„ ì €ì¥
                    newRow.classList.add(`day-${day}`); 
                    newRow.innerHTML = `
                        <td>${String(classCount).padStart(2, '0')}</td>
                        <td class="editable-content date-cell day-${day}" data-col="date">${dateDisplay}</td>
                        <td data-col="day" class="day-${day}">${dayOfWeek}</td> 
                        <td class="editable-content time-cell day-${day}" data-col="time">${timeData.display}</td>
                    `;
                    newRows.push(newRow);

                    dayIndex = (dayIndex + 1) % targetDays.length;
                }
            }
            
            currentDate.setDate(currentDate.getDate() + 1);
        }

        tableBody.innerHTML = '';
        newRows.forEach(row => tableBody.appendChild(row));
        
        updateLockState(true);
        sortTable(); 
    };
    
    // ----------------------------------------------------
    // [B] í…Œì´ë¸” í¸ì§‘/ì •ë ¬/ê°±ì‹  ë¡œì§
    // ----------------------------------------------------
    
    const parseDate = (dateStr) => {
        // ë‚ ì§œ í˜•ì‹ YYYY.MM.DD ë˜ëŠ” MM.DD ë¥¼ Date ê°ì²´ë¡œ ë³€í™˜
        const parts = dateStr.split('.');
        if (parts.length === 3) { return new Date(`${parts[0]}-${parts[1]}-${parts[2]}`); }
        if (parts.length === 2) { return new Date(`${currentYear}-${parts[0]}-${parts[1]}`); }
        return null;
    };

    const formatDateForInput = (dateStr) => {
        // YYYY.MM.DD í˜•ì‹ì„ Date inputì˜ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ë³€í™˜
        const parts = dateStr.split('.');
        if (parts.length === 3) { return `${parts[0]}-${parts[1]}-${parts[2]}`; }
        return '';
    };

    const formatDateForDisplay = (dateInput) => {
        // YYYY-MM-DD í˜•ì‹ì„ YYYY.MM.DD í˜•ì‹ìœ¼ë¡œ ë³€í™˜ (í…Œì´ë¸” í‘œì‹œìš©)
        const parts = dateInput.split('-');
        if (parts.length === 3) { return `${parts[0]}.${parts[1]}.${parts[2]}`; }
        return dateInput;
    };

    const getDayOfWeek = (dateInput) => {
        let dateObj;
        if (typeof dateInput === 'string') {
            dateObj = new Date(dateInput);
        } else {
            dateObj = dateObj;
        }

        const days = ['(ì¼)', '(ì›”)', '(í™”)', '(ìˆ˜)', '(ëª©)', '(ê¸ˆ)', '(í† )'];
        if (isNaN(dateObj)) return ''; 
        return days[dateObj.getDay()];
    };

    // íšŒì°¨ ë²ˆí˜¸ëŠ” ê³ ì •í•˜ê³ , ë‚ ì§œ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ë©° ì›” í—¤ë”ë¥¼ ì¶”ê°€/ì œê±°
    const sortTable = () => {
        const rows = Array.from(tableBody.querySelectorAll('tr:not(.month-header)'));
        
        rows.sort((a, b) => {
            const dateA = parseDate(a.getAttribute('data-date'));
            const dateB = parseDate(b.getAttribute('data-date'));
            // ë‚ ì§œê°€ ê°™ìœ¼ë©´ íšŒì°¨ ë²ˆí˜¸(data-class-no)ë¡œ ì •ë ¬
            if (dateA - dateB === 0) {
                return parseInt(a.getAttribute('data-class-no')) - parseInt(b.getAttribute('data-class-no'));
            }
            return dateA - dateB;
        });

        tableBody.innerHTML = ''; 
        
        let currentYearMonth = null;
        
        rows.forEach(row => {
            const dateStr = row.getAttribute('data-date');
            const dateObj = parseDate(dateStr);
            
            // ë‚ ì§œ ì •ë³´ê°€ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ì›” í—¤ë” ì¶”ê°€ ì—†ì´ ë°”ë¡œ í–‰ ì¶”ê°€
            if (!dateObj) {
                 tableBody.appendChild(row);
                 return;
            }

            const year = dateObj.getFullYear();
            const month = dateObj.getMonth() + 1;
            const yearMonth = `${year}-${month}`;

            if (currentYearMonth !== yearMonth) {
                currentYearMonth = yearMonth;
                
                const header = document.createElement('tr');
                header.classList.add('month-header');
                header.innerHTML = `<td colspan="4">ğŸ—“ï¸ ${year}ë…„ ${month}ì›”</td>`;
                tableBody.appendChild(header);
            }
            
            // íšŒì°¨ ë²ˆí˜¸(row.cells[0])ëŠ” data-class-noì— ì €ì¥ëœ ê³ ì •ëœ ê°’ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©
            tableBody.appendChild(row);
        });
    };

    // ì…ë ¥ í•„ë“œì˜ ë‚´ìš© ì €ì¥
    const saveContent = (inputElement) => {
        const parentCell = inputElement.closest('td');
        const row = parentCell.closest('tr');

        if (parentCell.classList.contains('date-cell')) {
            const newDateValue = inputElement.value.trim();
            
            // ìœ íš¨í•œ ë‚ ì§œê°€ ì•„ë‹ˆë©´ ì €ì¥í•˜ì§€ ì•ŠìŒ
            if (!newDateValue || isNaN(new Date(newDateValue))) {
                 // ì›ë˜ ë‚´ìš©ìœ¼ë¡œ ë³µì›
                parentCell.innerHTML = row.getAttribute('data-date'); 
            } else {
                const dateDisplay = formatDateForDisplay(newDateValue);
                const dayOfWeek = getDayOfWeek(newDateValue);
                
                const newDateObj = new Date(newDateValue);
                const dayIndex = newDateObj.getDay();

                // ìš”ì¼ í´ë˜ìŠ¤ ì—…ë°ì´íŠ¸
                const cells = row.querySelectorAll('td');
                cells.forEach(cell => {
                    cell.className = cell.className.replace(/day-\d/g, ''); 
                    cell.classList.add(`day-${dayIndex}`);
                });
                row.className = row.className.replace(/day-\d/g, '');
                row.classList.add(`day-${dayIndex}`);
                
                parentCell.innerHTML = dateDisplay;
                row.setAttribute('data-date', dateDisplay); 
                
                row.cells[2].innerHTML = dayOfWeek; // ìš”ì¼ ì—…ë°ì´íŠ¸

                sortTable(); // ë‚ ì§œ ë³€ê²½ ì‹œ ì •ë ¬ ì¬ì‹¤í–‰
            }
        
        } else if (parentCell.classList.contains('time-cell')) {
            const startTimeInput = parentCell.querySelector('[data-time-type="start"]');
            const endTimeInput = parentCell.querySelector('[data-time-type="end"]');

            const newStartTime = startTimeInput.value.trim();
            const newEndTime = endTimeInput.value.trim();
            
            // ì‹œê°„ ë°ì´í„° ì €ì¥ ë° í‘œì‹œ ì—…ë°ì´íŠ¸
            row.setAttribute('data-start-time', newStartTime);
            row.setAttribute('data-end-time', newEndTime);
            parentCell.innerHTML = `${newStartTime} - ${newEndTime}`;

        } else {
            // ê¸°íƒ€ í…ìŠ¤íŠ¸ í•„ë“œ ì²˜ë¦¬
            parentCell.innerHTML = inputElement.value.trim();
        }

        parentCell.classList.remove('editable-cell', 'date-input-field');
        currentEditingCell = null;
    };

    tableBody.addEventListener('click', (event) => {
        const cell = event.target.closest('.editable-content');
        
        if (!cell || cell.querySelector('input') || cell.querySelector('.time-input-fields')) return;
        
        if (currentEditingCell) {
            // í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ì…€ì´ ìˆìœ¼ë©´ ì €ì¥ (ì´ì „ ì…€ ì €ì¥)
            const inputToSave = currentEditingCell.querySelector('input[type="date"], input[type="text"]');
            const timeInputsToSave = currentEditingCell.querySelector('.time-input-fields input');
            if (inputToSave) {
                 saveContent(inputToSave);
            } else if (timeInputsToSave) {
                // ì‹œê°„ í•„ë“œì˜ ê²½ìš°, ì²« ë²ˆì§¸ í•„ë“œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì €ì¥ í•¨ìˆ˜ í˜¸ì¶œ
                saveContent(timeInputsToSave);
            }
        }

        const originalContent = cell.innerHTML.trim();
        const row = cell.closest('tr');
        cell.classList.add('editable-cell'); 
        
        let inputHTML;
        if (cell.classList.contains('date-cell')) {
            // ë‚ ì§œ ìˆ˜ì •
            const dateValue = formatDateForInput(row.getAttribute('data-date'));
            inputHTML = `<input type="date" value="${dateValue}" />`;
            cell.classList.add('date-input-field'); 
        
        } else if (cell.classList.contains('time-cell')) {
            // ì‹œê°„ ìˆ˜ì • (ì‹œì‘ ì‹œê°„ - ì¢…ë£Œ ì‹œê°„ ë¶„ë¦¬)
            const currentStart = row.getAttribute('data-start-time');
            const currentEnd = row.getAttribute('data-end-time');
            
            inputHTML = `
                <div class="time-input-fields">
                    <input type="time" value="${currentStart}" data-time-type="start" required step="600" />
                    <span>-</span>
                    <input type="time" value="${currentEnd}" data-time-type="end" required step="600" />
                </div>
            `;
        } else {
            // ê¸°íƒ€ í…ìŠ¤íŠ¸ í•„ë“œ 
            inputHTML = `<input type="text" value="${originalContent.replace(/"/g, '&quot;')}" />`;
        }

        cell.innerHTML = inputHTML;
        
        let input = cell.querySelector('input');
        
        if (input) {
            input.focus();
            currentEditingCell = cell;

            const inputsToListen = cell.querySelectorAll('input');
            
            inputsToListen.forEach(i => {
                // Enter í‚¤ ì €ì¥ ë¡œì§
                i.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault(); 
                        saveContent(i);
                        i.blur();
                    }
                });
                // Blur ì´ë²¤íŠ¸ëŠ” ë‹¤ë¥¸ ì…€ í´ë¦­/Enterë¡œë§Œ ì €ì¥í•˜ë„ë¡ ë‹¨ìˆœí™”
            });
        }
    });

    document.addEventListener('keydown', (event) => {
        if (currentEditingCell && event.key === 'Delete') {
            const rowToDelete = currentEditingCell.closest('tr');
            const classNo = rowToDelete.getAttribute('data-class-no');
            
            // ì´ íšŒì°¨ ìˆ˜ ${totalClassesInput.value}ì€(ëŠ”) ì ˆëŒ€ ê³ ì • ìœ ì§€ë¨ì„ ëª…ì‹œ
            if (confirm(`ì •ë§ë¡œ íšŒì°¨ #${classNo}ì„(ë¥¼) ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì´ íšŒì°¨ ìˆ˜ ${totalClassesInput.value}ì€(ëŠ”) ì ˆëŒ€ ê³ ì • ìœ ì§€ë©ë‹ˆë‹¤. í•´ë‹¹ ë²ˆí˜¸ëŠ” ë¹ˆ ì¹¸ì´ ë©ë‹ˆë‹¤.)`)) {
                
                // 1. ì‚­ì œ
                rowToDelete.remove();
                currentEditingCell = null; 
                
                // 2. ì´ íšŒì°¨ ìˆ˜ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€

                // 3. ì •ë ¬ ë° ì›” í—¤ë” ì—…ë°ì´íŠ¸
                sortTable(); 
                event.preventDefault(); 
            }
        }
    });
</script>
</body>
</html>